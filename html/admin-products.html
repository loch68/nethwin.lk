<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Products - NethwinLK</title>
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="" />
    <link
      rel="stylesheet"
      as="style"
      onload="this.rel='stylesheet'"
      href="https://fonts.googleapis.com/css2?display=swap&amp;family=Noto+Sans%3Awght%40400%3B500%3B700%3B900&amp;family=Work+Sans%3Awght%40400%3B500%3B700%3B900"
    />
    <!-- Tailwind CSS CDN - Development only. For production, install as PostCSS plugin -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link rel="stylesheet" href="../css/hover-effects.css" />
    <link rel="stylesheet" href="../css/navbar.css" />
    <link rel="stylesheet" href="../css/background-animations.css" />
    <link rel="stylesheet" href="../css/responsive.css" />
    <style>
        .sidebar-transition {
            transition: transform 0.3s ease-in-out;
        }
        .sidebar-hidden {
            transform: translateX(-100%);
        }
        
        /* Enhanced styling */
        .admin-card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            border: 1px solid #e5e7eb;
            transition: all 0.3s ease;
        }
        
        .admin-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        
        /* Enhanced button styling */
        .btn-enhanced {
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .btn-enhanced:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .btn-enhanced:active {
            transform: translateY(0);
        }
        
        /* Enhanced header styling */
        .dashboard-header {
            background: linear-gradient(135deg, #f8fbfa 0%, #e8f2ec 100%);
            border-radius: 16px;
            border: 1px solid #d1e6d9;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        
        /* Animation for loading */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .fade-in-up {
            animation: fadeInUp 0.6s ease-out;
        }
    </style>
    <script src="../javascript/auth.js"></script>
    <script src="../javascript/button-refresh.js"></script>
</head>
<body>
    <div class="relative flex size-full min-h-screen flex-col bg-[#f8fbfa] group/design-root overflow-x-hidden" style="font-family: Inter, 'Noto Sans', sans-serif;">
        <div class="layout-container flex h-full grow flex-col">
            
            <!-- Sidebar -->
            <div id="sidebar" class="fixed left-0 top-0 z-40 h-screen w-64 bg-white shadow-lg sidebar-transition">
                <div class="flex h-full flex-col">
                    <!-- Logo Section -->
                    <div class="flex items-center gap-4 p-6 border-b border-[#e8f2ec]">
                        <div class="size-4">
                            <svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path
                                    fill-rule="evenodd"
                                    clip-rule="evenodd"
                                    d="M39.475 21.6262C40.358 21.4363 40.6863 21.5589 40.7581 21.5934C40.7876 21.655 40.8547 21.857 40.8082 22.3336C40.7408 23.0255 40.4502 24.0046 39.8572 25.2301C38.6799 27.6631 36.5085 30.6631 33.5858 33.5858C30.6631 36.5085 27.6632 38.6799 25.2301 39.8572C24.0046 40.4502 23.0255 40.7407 22.3336 40.8082C21.8571 40.8547 21.6551 40.7875 21.5934 40.7581C21.5589 40.6863 21.4363 40.358 21.6262 39.475C21.8562 38.4054 22.4689 36.9657 23.5038 35.2817C24.7575 33.2417 26.5497 30.9744 28.7621 28.762C30.9744 26.5497 33.2417 24.7574 35.2817 23.5037C36.9657 22.4689 38.4054 21.8562 39.475 21.6262ZM4.41189 29.2403L18.7597 43.5881C19.8813 44.7097 21.4027 44.9179 22.7217 44.7893C24.0585 44.659 25.5148 44.1631 26.9723 43.4579C29.9052 42.0387 33.2618 39.5667 36.4142 36.4142C39.5667 33.2618 42.0387 29.9052 43.4579 26.9723C44.1631 25.5148 44.659 24.0585 44.7893 22.7217C44.9179 21.4027 44.7097 19.8813 43.5881 18.7597L29.2403 4.41187C27.8527 3.02428 25.8765 3.02573 24.2861 3.36776C22.6081 3.72863 20.7334 4.58419 18.8396 5.74801C16.4978 7.18716 13.9881 9.18353 11.5858 11.5858C9.18354 13.988 7.18717 16.4978 5.74802 18.8396C4.58421 20.7334 3.72865 22.6081 3.36778 24.2861C3.02574 25.8765 3.02429 27.8527 4.41189 29.2403Z"
                                    fill="#19e619"
                                ></path>
                            </svg>
                        </div>
                        <h2 class="text-[#0e1a13] text-lg font-bold leading-tight tracking-[-0.015em]">NethwinLK Admin</h2>
                    </div>

                    <!-- Navigation Menu -->
                    <nav class="flex-1 p-4 space-y-2">
                        <a href="admin-dashboard.html" class="flex items-center gap-3 px-4 py-3 text-[#4e974e] hover:text-[#19e619] hover:bg-[#e8f2ec] rounded-lg font-medium transition-colors">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5a2 2 0 012-2h4a2 2 0 012 2v6H8V5z"></path>
                            </svg>
                            Dashboard
                        </a>
                        <a href="admin-users.html" class="flex items-center gap-3 px-4 py-3 text-[#4e974e] hover:text-[#19e619] hover:bg-[#e8f2ec] rounded-lg font-medium transition-colors">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"></path>
                            </svg>
                            Users
                        </a>
                        <a href="admin-bookshop-orders.html" class="flex items-center gap-3 px-4 py-3 text-[#4e974e] hover:text-[#19e619] hover:bg-[#e8f2ec] rounded-lg font-medium transition-colors">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                            </svg>
                            Bookshop Orders
                        </a>
                        <a href="admin-print-orders.html" class="flex items-center gap-3 px-4 py-3 text-[#4e974e] hover:text-[#19e619] hover:bg-[#e8f2ec] rounded-lg font-medium transition-colors">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path>
                            </svg>
                            Print Orders
                        </a>
                        <a href="admin-print-queue.html" class="flex items-center gap-3 px-4 py-3 text-[#4e974e] hover:text-[#19e619] hover:bg-[#e8f2ec] rounded-lg font-medium transition-colors">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"></path>
                            </svg>
                            Queue Management
                        </a>
                        <a href="admin-products.html" class="flex items-center gap-3 px-4 py-3 text-[#19e619] bg-[#e8f2ec] rounded-lg font-medium">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
                            </svg>
                            Products
                        </a>
                        <a href="admin-reviews.html" class="flex items-center gap-3 px-4 py-3 text-[#4e974e] hover:text-[#19e619] hover:bg-[#e8f2ec] rounded-lg font-medium transition-colors">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"></path>
                            </svg>
                            Reviews
                        </a>
                        <a href="admin-messages.html" class="flex items-center gap-3 px-4 py-3 text-[#4e974e] hover:text-[#19e619] hover:bg-[#e8f2ec] rounded-lg font-medium transition-colors">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4-.8L3 20l.8-4A8.94 8.94 0 013 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
                            </svg>
                            Messages
                        </a>
                    <a href="admin-settings.html" class="flex items-center gap-3 px-4 py-3 text-[#4e974e] hover:text-[#19e619] hover:bg-[#e8f2ec] rounded-lg font-medium transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        </svg>
                        Settings
                    </a>
                    
                    </nav>

                    <!-- User Mode & Logout Section -->
                    <div class="p-4 border-t border-[#e8f2ec] space-y-2">
                        <button 
                            id="userModeBtn" 
                            class="flex items-center gap-3 px-4 py-3 text-[#4e974e] hover:text-blue-600 hover:bg-blue-50 rounded-lg font-medium transition-colors w-full text-left"
                            title="Switch to User Mode for Testing"
                        >
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                            </svg>
                            User Mode
                        </button>
                        <button onclick="logout()" class="flex items-center gap-3 px-4 py-3 text-[#4e974e] hover:text-red-600 hover:bg-red-50 rounded-lg font-medium transition-colors w-full">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                            </svg>
                            Logout
                        </button>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="ml-64 flex-1">
                <header
                    class="flex items-center justify-between whitespace-nowrap border-b border-solid border-b-[#e8f2ec] px-10 py-3"
                >
                    <div class="flex items-center gap-4 text-[#0e1a13]"></div>
                </header>

                <!-- Main Content Area -->
                <div class="px-40 flex flex-1 justify-center py-5">
                    <div class="layout-content-container flex flex-col max-w-[960px] flex-1">
                        <!-- Header Section -->
                        <div class="flex flex-wrap justify-between items-center gap-6 p-6 dashboard-header mb-6">
                            <div class="flex items-center space-x-4">
                                <div class="bg-[#0e1a13] p-3 rounded-xl">
                                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
                                    </svg>
                                </div>
                                <div>
                                    <h1 class="text-[#0e1a13] tracking-light text-3xl font-bold leading-tight">Products</h1>
                                    <p class="text-[#51946c] text-lg font-medium">Manage your product catalog and inventory</p>
                                </div>
                            </div>
                        </div>

                        <!-- Products Content -->
                        <div class="px-6 py-6">
                            <!-- Action Buttons -->
                            <div class="flex flex-col sm:flex-row gap-4 mb-6">
                                <button id="addProductBtn" class="bg-gradient-to-r from-[#0ad167] to-[#078829] hover:from-[#078829] hover:to-[#0ad167] text-white py-3 px-6 rounded-lg font-medium transition-all duration-200 shadow-md hover:shadow-lg btn-enhanced flex items-center space-x-2">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                    </svg>
                                    <span>Add New Product</span>
                                </button>
                                <button id="bulkUploadBtn" class="bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white py-3 px-6 rounded-lg font-medium transition-all duration-200 shadow-md hover:shadow-lg btn-enhanced flex items-center space-x-2">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"></path>
                                    </svg>
                                    <span>Bulk Upload</span>
                                </button>
                                
                                <!-- Enhanced Export Buttons -->
                                <div class="flex flex-col sm:flex-row gap-2">
                                    <button onclick="exportProductsEnhanced()" class="bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white py-3 px-4 rounded-lg font-medium transition-all duration-200 shadow-md hover:shadow-lg btn-enhanced flex items-center space-x-2">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                        </svg>
                                        <span>📊 Export Catalog with Charts</span>
                                    </button>
                                </div>
                                <button id="bulkDeleteBtn" class="bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white py-3 px-6 rounded-lg font-medium transition-all duration-200 shadow-md hover:shadow-lg btn-enhanced flex items-center space-x-2">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                    </svg>
                                    <span>Bulk Delete</span>
                                </button>
                                <button id="refreshProductsBtn" class="bg-gray-100 hover:bg-gray-200 text-gray-700 py-3 px-6 rounded-lg font-medium transition-all duration-200 btn-enhanced flex items-center space-x-2">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                    </svg>
                                    <span>Refresh</span>
                                </button>
                            </div>

                            <!-- Products Table -->
                            <div class="admin-card fade-in-up">
                                <div class="p-6 border-b border-gray-200">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-3">
                                            <div class="p-2 bg-green-100 rounded-lg">
                                                <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
                                                </svg>
                                            </div>
                                            <div>
                                                <h3 class="text-xl font-bold text-[#0e1a13]">Products</h3>
                                                <p class="text-[#51946c] text-sm">Manage your product catalog</p>
                                            </div>
                                        </div>
                                        <div class="text-sm text-gray-500">
                                            Total: <span id="totalProductsCount" class="font-semibold text-[#0e1a13]">0</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Search and Filters -->
                                <div class="p-6 border-b border-gray-200">
                                    <div class="flex flex-col sm:flex-row gap-4">
                                        <div class="flex-1">
                                            <div class="relative">
                                                <input type="text" id="productSearch" placeholder="Search products..." class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#0ad167] focus:border-transparent">
                                                <svg class="absolute left-3 top-2.5 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                                </svg>
                                            </div>
                                        </div>
                                        <select id="categoryFilter" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#0ad167] focus:border-transparent">
                                            <option value="">All Categories</option>
                                            <option value="book-lists">Book Lists</option>
                                            <option value="books">Books</option>
                                            <option value="pens">Pens</option>
                                            <option value="color-products">Color Products</option>
                                            <option value="school-products">School Products</option>
                                            <option value="office-products">Office Products</option>
                                            <option value="bottle-and-boxes">Bottle and Boxes</option>
                                            <option value="highlighters-and-markers">Highlighters and Markers</option>
                                            <option value="paper-products">Paper Products</option>
                                            <option value="toys">Toys</option>
                                            <option value="innovate">Innovate</option>
                                            <option value="homerun">Homerun</option>
                                        </select>
                                        <select id="statusFilter" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#0ad167] focus:border-transparent">
                                            <option value="">All Status</option>
                                            <option value="active">Active</option>
                                            <option value="inactive">Inactive</option>
                                            <option value="discontinued">Discontinued</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- Products Table -->
                                <div class="overflow-x-auto">
                                    <table class="w-full">
                                        <thead class="bg-gray-50">
                                            <tr>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Product</th>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Category</th>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Price</th>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Stock</th>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="productsTableBody" class="bg-white divide-y divide-gray-200">
                                            <!-- Products will be loaded here -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Product Modal -->
    <div id="addProductModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 hidden">
        <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white">
            <div class="mt-3">
                <!-- Modal Header -->
                <div class="flex items-center justify-between pb-4 border-b border-gray-200">
                    <h3 class="text-lg font-semibold text-[#0e1a13]">Add New Product</h3>
                    <button id="closeModalBtn" class="text-gray-400 hover:text-gray-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>

                <!-- Modal Body -->
                <form id="addProductForm" class="mt-6 space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Product ID -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Product ID / SKU *</label>
                            <input type="text" id="productId" name="productId" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#0ad167] focus:border-transparent" placeholder="e.g., PROD-001">
                        </div>

                        <!-- Product Name -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Product Name *</label>
                            <input type="text" id="productName" name="name" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#0ad167] focus:border-transparent" placeholder="Enter product name">
                        </div>

                        <!-- Category -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Category *</label>
                            <select id="productCategory" name="category" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#0ad167] focus:border-transparent">
                                <option value="">Select Category</option>
                                <option value="book-lists">Book Lists</option>
                                <option value="books">Books</option>
                                <option value="pens">Pens</option>
                                <option value="color-products">Color Products</option>
                                <option value="school-products">School Products</option>
                                <option value="office-products">Office Products</option>
                                <option value="bottle-and-boxes">Bottle and Boxes</option>
                                <option value="highlighters-and-markers">Highlighters and Markers</option>
                                <option value="paper-products">Paper Products</option>
                                <option value="toys">Toys</option>
                                <option value="innovate">Innovate</option>
                                <option value="homerun">Homerun</option>
                            </select>
                        </div>

                        <!-- Brand -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Brand</label>
                            <input type="text" id="productBrand" name="brand" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#0ad167] focus:border-transparent" placeholder="Enter brand name">
                        </div>

                        <!-- Selling Price -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Selling Price (Rs.) *</label>
                            <input type="number" id="sellingPrice" name="sellingPrice" required min="0" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#0ad167] focus:border-transparent" placeholder="0.00">
                        </div>

                        <!-- Purchase Price -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Purchase Price (Rs.) *</label>
                            <input type="number" id="purchasePrice" name="purchasePrice" required min="0" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#0ad167] focus:border-transparent" placeholder="0.00">
                        </div>

                        <!-- Stock -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Stock Quantity *</label>
                            <input type="number" id="stock" name="stock" required min="0" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#0ad167] focus:border-transparent" placeholder="0">
                        </div>

                        <!-- Discount Price -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Discount Price (Rs.)</label>
                            <input type="number" id="discountPrice" name="discountPrice" min="0" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#0ad167] focus:border-transparent" placeholder="0.00">
                        </div>
                    </div>

                    <!-- Description -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                        <textarea id="productDescription" name="description" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#0ad167] focus:border-transparent" placeholder="Enter product description"></textarea>
                    </div>

                    <!-- Image Upload -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Product Images</label>
                        <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-lg hover:border-gray-400 transition-colors">
                            <div class="space-y-1 text-center">
                                <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                                    <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                </svg>
                                <div class="flex text-sm text-gray-600">
                                    <label for="productImages" class="relative cursor-pointer bg-white rounded-md font-medium text-[#0ad167] hover:text-[#078829] focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-[#0ad167]">
                                        <span>Upload images</span>
                                        <input id="productImages" name="images" type="file" multiple accept="image/*" class="sr-only">
                                    </label>
                                    <p class="pl-1">or drag and drop</p>
                                </div>
                                <p class="text-xs text-gray-500">PNG, JPG, GIF up to 5MB each</p>
                            </div>
                        </div>
                        <div id="imagePreview" class="mt-4 grid grid-cols-2 md:grid-cols-4 gap-4 hidden">
                            <!-- Image previews will be shown here -->
                        </div>
                    </div>

                    <!-- Variants -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Product Variants</label>
                        <div id="variantsContainer" class="space-y-3">
                            <div class="flex space-x-3">
                                <input type="text" placeholder="Size" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#0ad167] focus:border-transparent">
                                <input type="text" placeholder="Color" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#0ad167] focus:border-transparent">
                                <button type="button" id="removeVariantBtn" class="px-3 py-2 text-red-600 hover:text-red-800 hidden">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <button type="button" id="addVariantBtn" class="mt-2 text-sm text-[#0ad167] hover:text-[#078829] font-medium">+ Add Variant</button>
                    </div>

                    <!-- Status -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                        <select id="productStatus" name="status" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#0ad167] focus:border-transparent">
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                            <option value="discontinued">Discontinued</option>
                        </select>
                    </div>
                </form>

                <!-- Modal Footer -->
                <div class="flex items-center justify-end space-x-3 pt-6 border-t border-gray-200">
                    <button type="button" id="cancelBtn" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-lg hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500">
                        Cancel
                    </button>
                    <button type="submit" form="addProductForm" id="saveProductBtn" class="px-4 py-2 text-sm font-medium text-white bg-[#0ad167] border border-transparent rounded-lg hover:bg-[#078829] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#0ad167]">
                        Save Product
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Product Modal -->
    <div id="editProductModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 hidden">
        <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white">
            <div class="mt-3">
                <!-- Modal Header -->
                <div class="flex items-center justify-between pb-4 border-b border-gray-200">
                    <h3 class="text-lg font-semibold text-[#0e1a13]">Edit Product</h3>
                    <button id="closeEditModalBtn" class="text-gray-400 hover:text-gray-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>

                <!-- Modal Body -->
                <form id="editProductForm" class="mt-6 space-y-6">
                    <input type="hidden" id="editProductId" name="productId">
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Product ID -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Product ID / SKU *</label>
                            <input type="text" id="editProductIdField" name="productId" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#0ad167] focus:border-transparent" placeholder="e.g., PROD-001">
                        </div>

                        <!-- Product Name -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Product Name *</label>
                            <input type="text" id="editProductName" name="name" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#0ad167] focus:border-transparent" placeholder="Enter product name">
                        </div>

                        <!-- Category -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Category *</label>
                            <select id="editProductCategory" name="category" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#0ad167] focus:border-transparent">
                                <option value="">Select Category</option>
                                <option value="book-lists">Book Lists</option>
                                <option value="books">Books</option>
                                <option value="pens">Pens</option>
                                <option value="color-products">Color Products</option>
                                <option value="school-products">School Products</option>
                                <option value="office-products">Office Products</option>
                                <option value="bottle-and-boxes">Bottle and Boxes</option>
                                <option value="highlighters-and-markers">Highlighters and Markers</option>
                                <option value="paper-products">Paper Products</option>
                                <option value="toys">Toys</option>
                                <option value="innovate">Innovate</option>
                                <option value="homerun">Homerun</option>
                            </select>
                        </div>

                        <!-- Brand -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Brand</label>
                            <input type="text" id="editProductBrand" name="brand" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#0ad167] focus:border-transparent" placeholder="Enter brand name">
                        </div>

                        <!-- Selling Price -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Selling Price (Rs.) *</label>
                            <input type="number" id="editSellingPrice" name="sellingPrice" required min="0" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#0ad167] focus:border-transparent" placeholder="0.00">
                        </div>

                        <!-- Purchase Price -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Purchase Price (Rs.) *</label>
                            <input type="number" id="editPurchasePrice" name="purchasePrice" required min="0" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#0ad167] focus:border-transparent" placeholder="0.00">
                        </div>

                        <!-- Stock -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Stock Quantity *</label>
                            <input type="number" id="editStock" name="stock" required min="0" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#0ad167] focus:border-transparent" placeholder="0">
                        </div>

                        <!-- Discount Price -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Discount Price (Rs.)</label>
                            <input type="number" id="editDiscountPrice" name="discountPrice" min="0" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#0ad167] focus:border-transparent" placeholder="0.00">
                        </div>
                    </div>

                    <!-- Description -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                        <textarea id="editProductDescription" name="description" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#0ad167] focus:border-transparent" placeholder="Enter product description"></textarea>
                    </div>

                    <!-- Current Images -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Current Images</label>
                        <div id="currentImagesContainer" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <!-- Current images will be shown here -->
                        </div>
                    </div>

                    <!-- Image Upload -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Add New Images</label>
                        <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-lg hover:border-gray-400 transition-colors">
                            <div class="space-y-1 text-center">
                                <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                                    <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                </svg>
                                <div class="flex text-sm text-gray-600">
                                    <label for="editProductImages" class="relative cursor-pointer bg-white rounded-md font-medium text-[#0ad167] hover:text-[#078829] focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-[#0ad167]">
                                        <span>Upload new images</span>
                                        <input id="editProductImages" name="images" type="file" multiple accept="image/*" class="sr-only">
                                    </label>
                                    <p class="pl-1">or drag and drop</p>
                                </div>
                                <p class="text-xs text-gray-500">PNG, JPG, GIF up to 5MB each</p>
                            </div>
                        </div>
                        <div id="editImagePreview" class="mt-4 grid grid-cols-2 md:grid-cols-4 gap-4 hidden">
                            <!-- New image previews will be shown here -->
                        </div>
                    </div>

                    <!-- Variants -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Product Variants</label>
                        <div id="editVariantsContainer" class="space-y-3">
                            <!-- Variants will be loaded here -->
                        </div>
                        <button type="button" id="addEditVariantBtn" class="mt-2 text-sm text-[#0ad167] hover:text-[#078829] font-medium">+ Add Variant</button>
                    </div>

                    <!-- Status -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                        <select id="editProductStatus" name="status" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#0ad167] focus:border-transparent">
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                            <option value="discontinued">Discontinued</option>
                        </select>
                    </div>
                </form>

                <!-- Modal Footer -->
                <div class="flex items-center justify-end space-x-3 pt-6 border-t border-gray-200">
                    <button type="button" id="cancelEditBtn" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-lg hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500">
                        Cancel
                    </button>
                    <button type="submit" form="editProductForm" id="updateProductBtn" class="px-4 py-2 text-sm font-medium text-white bg-[#0ad167] border border-transparent rounded-lg hover:bg-[#078829] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#0ad167]">
                        Update Product
                    </button>
                </div>
            </div>
        </div>
    </div>

    </div>

    <!-- Bulk Upload Modal -->
    <div id="bulkUploadModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 hidden">
        <div class="relative top-10 mx-auto p-5 border w-11/12 md:w-4/5 lg:w-3/4 xl:w-2/3 shadow-lg rounded-md bg-white">
            <div class="mt-3">
                <!-- Modal Header -->
                <div class="flex items-center justify-between pb-4 border-b border-gray-200">
                    <h3 class="text-lg font-semibold text-[#0e1a13]">Bulk Product Upload</h3>
                    <button id="closeBulkModalBtn" class="text-gray-400 hover:text-gray-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>

                <!-- Modal Body -->
                <div class="mt-6 space-y-6">
                    <!-- Instructions -->
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <h4 class="text-sm font-medium text-blue-800 mb-2">📋 Upload Instructions</h4>
                        <ul class="text-sm text-blue-700 space-y-1">
                            <li>• Upload an Excel file (.xlsx) with product data following the exact template format</li>
                            <li>• Upload a ZIP file containing product images with matching names</li>
                            <li>• Image names must exactly match the product names in Excel (case-insensitive)</li>
                            <li>• Supported image formats: JPG, JPEG, WEBP</li>
                            <li>• All images will be uploaded to Cloudinary for global CDN delivery</li>
                        </ul>
                    </div>

                    <!-- File Upload Section -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Excel File Upload -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Excel File (.xlsx) *</label>
                            <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-lg hover:border-gray-400 transition-colors">
                                <div class="space-y-1 text-center">
                                    <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                                        <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                    </svg>
                                    <div class="flex text-sm text-gray-600">
                                        <label for="excelFile" class="relative cursor-pointer bg-white rounded-md font-medium text-blue-600 hover:text-blue-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-blue-500">
                                            <span>Upload Excel file</span>
                                            <input id="excelFile" name="excelFile" type="file" accept=".xlsx,.xls" autocomplete="off" class="sr-only">
                                        </label>
                                        <p class="pl-1">or drag and drop</p>
                                    </div>
                                    <p class="text-xs text-gray-500">Excel files only</p>
                                </div>
                            </div>
                            <div id="excelFileInfo" class="mt-2 text-sm text-gray-600 hidden">
                                <!-- Excel file info will be shown here -->
                            </div>
                        </div>

                        <!-- ZIP File Upload -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ZIP File with Images *</label>
                            <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-lg hover:border-gray-400 transition-colors">
                                <div class="space-y-1 text-center">
                                    <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                                        <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                    </svg>
                                    <div class="flex text-sm text-gray-600">
                                        <label for="zipFile" class="relative cursor-pointer bg-white rounded-md font-medium text-blue-600 hover:text-blue-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-blue-500">
                                            <span>Upload ZIP file</span>
                                            <input id="zipFile" name="zipFile" type="file" accept=".zip" autocomplete="off" class="sr-only">
                                        </label>
                                        <p class="pl-1">or drag and drop</p>
                                    </div>
                                    <p class="text-xs text-gray-500">ZIP files only</p>
                                </div>
                            </div>
                            <div id="zipFileInfo" class="mt-2 text-sm text-gray-600 hidden">
                                <!-- ZIP file info will be shown here -->
                            </div>
                        </div>
                    </div>

                    <!-- Template Download -->
                    <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                        <h4 class="text-sm font-medium text-gray-800 mb-2">📄 Excel Template</h4>
                        <p class="text-sm text-gray-600 mb-3">Download the Excel template to ensure proper formatting:</p>
                        <button id="downloadTemplateBtn" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors flex items-center space-x-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            <span>Download Template</span>
                        </button>
                    </div>

                    <!-- Progress Section -->
                    <div id="uploadProgress" class="hidden">
                        <h4 class="text-sm font-medium text-gray-800 mb-2">📊 Upload Progress</h4>
                        <div class="bg-gray-200 rounded-full h-2 mb-2">
                            <div id="progressBar" class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                        </div>
                        <div class="flex justify-between text-sm text-gray-600">
                            <span id="progressText">Preparing upload...</span>
                            <span id="progressPercent">0%</span>
                        </div>
                        <div id="uploadLog" class="mt-4 max-h-40 overflow-y-auto bg-gray-50 rounded-lg p-3 text-sm">
                            <!-- Upload log will be shown here -->
                        </div>
                    </div>

                    <!-- Results Section -->
                    <div id="uploadResults" class="hidden">
                        <h4 class="text-sm font-medium text-gray-800 mb-2">📈 Upload Results</h4>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="bg-green-50 border border-green-200 rounded-lg p-3">
                                <div class="text-2xl font-bold text-green-600" id="successCount">0</div>
                                <div class="text-sm text-green-700">Successful</div>
                            </div>
                            <div class="bg-red-50 border border-red-200 rounded-lg p-3">
                                <div class="text-2xl font-bold text-red-600" id="errorCount">0</div>
                                <div class="text-sm text-red-700">Failed</div>
                            </div>
                            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3">
                                <div class="text-2xl font-bold text-yellow-600" id="warningCount">0</div>
                                <div class="text-sm text-yellow-700">Warnings</div>
                            </div>
                        </div>
                        <div id="detailedResults" class="mt-4 max-h-60 overflow-y-auto bg-gray-50 rounded-lg p-3 text-sm">
                            <!-- Detailed results will be shown here -->
                        </div>
                    </div>
                </div>

                <!-- Modal Footer -->
                <div class="flex items-center justify-end space-x-3 pt-6 border-t border-gray-200">
                    <button type="button" id="cancelBulkBtn" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-lg hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500">
                        Cancel
                    </button>
                    <button type="button" id="startBulkUploadBtn" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        Start Bulk Upload
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bulk Delete Modal -->
    <div id="bulkDeleteModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 hidden">
        <div class="relative top-10 mx-auto p-5 border w-11/12 md:w-2/3 lg:w-1/2 shadow-lg rounded-md bg-white">
            <div class="mt-3">
                <!-- Modal Header -->
                <div class="flex items-center justify-between pb-4 border-b border-gray-200">
                    <h3 class="text-lg font-semibold text-red-600 flex items-center">
                        <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                        </svg>
                        Bulk Delete Products
                    </h3>
                    <button id="closeBulkDeleteModalBtn" class="text-gray-400 hover:text-gray-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>

                <!-- Modal Body -->
                <div class="mt-6 space-y-4">
                    <!-- Warning Message -->
                    <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                        <div class="flex">
                            <svg class="w-5 h-5 text-red-400 mt-0.5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                            </svg>
                            <div>
                                <h4 class="text-sm font-medium text-red-800">⚠️ DANGER: This action cannot be undone!</h4>
                                <p class="text-sm text-red-700 mt-1">
                                    This will permanently delete <strong id="deleteCount">all products</strong> from the database and their associated images from Cloudinary.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Step 1: Confirmation -->
                    <div id="deleteStep1" class="space-y-4">
                        <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                            <h4 class="text-sm font-medium text-gray-800 mb-2">📋 What will be deleted:</h4>
                            <ul class="text-sm text-gray-600 space-y-1">
                                <li>• All product records from the database</li>
                                <li>• All product images from Cloudinary</li>
                                <li>• All associated product reviews and ratings</li>
                                <li>• All order history related to these products</li>
                            </ul>
                        </div>

                        <div class="flex items-center">
                            <input id="confirmDeleteCheckbox" type="checkbox" class="h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300 rounded">
                            <label for="confirmDeleteCheckbox" class="ml-2 text-sm text-gray-700">
                                I understand this action is <strong>permanent and cannot be undone</strong>
                            </label>
                        </div>
                    </div>

                    <!-- Step 2: Final Confirmation -->
                    <div id="deleteStep2" class="space-y-4 hidden">
                        <div class="bg-red-100 border border-red-300 rounded-lg p-4">
                            <h4 class="text-sm font-medium text-red-800 mb-2">🚨 FINAL WARNING</h4>
                            <p class="text-sm text-red-700">
                                You are about to delete <strong id="finalDeleteCount">all products</strong>. 
                                Type <strong>"DELETE ALL PRODUCTS"</strong> in the box below to confirm:
                            </p>
                        </div>

                        <div>
                            <input id="deleteConfirmationInput" type="text" placeholder="Type: DELETE ALL PRODUCTS" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500">
                        </div>
                    </div>

                    <!-- Progress Section -->
                    <div id="deleteProgress" class="hidden">
                        <h4 class="text-sm font-medium text-gray-800 mb-2">🗑️ Deleting Products...</h4>
                        <div class="bg-gray-200 rounded-full h-2 mb-2">
                            <div id="deleteProgressBar" class="bg-red-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                        </div>
                        <div class="flex justify-between text-sm text-gray-600">
                            <span id="deleteProgressText">Preparing deletion...</span>
                            <span id="deleteProgressPercent">0%</span>
                        </div>
                        <div id="deleteLog" class="mt-4 max-h-40 overflow-y-auto bg-gray-50 rounded-lg p-3 text-sm">
                            <!-- Delete log will be shown here -->
                        </div>
                    </div>

                    <!-- Results Section -->
                    <div id="deleteResults" class="hidden">
                        <h4 class="text-sm font-medium text-gray-800 mb-2">📊 Deletion Results</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="bg-red-50 border border-red-200 rounded-lg p-3">
                                <div class="text-2xl font-bold text-red-600" id="deletedCount">0</div>
                                <div class="text-sm text-red-700">Products Deleted</div>
                            </div>
                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
                                <div class="text-2xl font-bold text-blue-600" id="imagesDeletedCount">0</div>
                                <div class="text-sm text-blue-700">Images Deleted</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Modal Footer -->
                <div class="flex items-center justify-end space-x-3 pt-6 border-t border-gray-200">
                    <button type="button" id="cancelBulkDeleteBtn" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-lg hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500">
                        Cancel
                    </button>
                    <button type="button" id="proceedDeleteBtn" class="px-4 py-2 text-sm font-medium text-white bg-red-600 border border-transparent rounded-lg hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        Proceed to Step 2
                    </button>
                    <button type="button" id="confirmDeleteBtn" class="px-4 py-2 text-sm font-medium text-white bg-red-600 border border-transparent rounded-lg hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50 disabled:cursor-not-allowed hidden">
                        DELETE ALL PRODUCTS
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Export Format Selection Modal -->
    <div id="exportFormatModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 hidden">
        <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-1/3 shadow-lg rounded-md bg-white">
            <div class="mt-3">
                <!-- Modal Header -->
                <div class="flex items-center justify-between pb-4 border-b border-gray-200">
                    <h3 class="text-lg font-semibold text-[#0e1a13]" id="exportModalTitle">Select Export Format</h3>
                    <button id="closeExportModalBtn" class="text-gray-400 hover:text-gray-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>

                <!-- Modal Body -->
                <div class="mt-4">
                    <p class="text-gray-600 mb-4" id="exportModalDescription">Choose the format for your export:</p>
                    
                    <div class="space-y-3">
                        <button id="exportExcelBtn" class="w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white py-3 px-4 rounded-lg font-medium transition-all duration-200 shadow-md hover:shadow-lg flex items-center justify-center space-x-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            <span>Export as Excel (.xlsx)</span>
                        </button>
                        
                        <button id="exportPdfBtn" class="w-full bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white py-3 px-4 rounded-lg font-medium transition-all duration-200 shadow-md hover:shadow-lg flex items-center justify-center space-x-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                            </svg>
                            <span>Export as PDF (.html)</span>
                        </button>
                    </div>
                </div>

                <!-- Modal Footer -->
                <div class="mt-6 flex justify-end space-x-3">
                    <button id="cancelExportBtn" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 transition-colors">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let products = [];
        let filteredProducts = [];
        let uploadedImages = [];
        let editUploadedImages = [];
        let currentEditingProduct = null;

        // Authentication check
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is logged in and is admin
            if (!window.authManager.isLoggedIn()) {
                window.location.href = 'admin-login.html';
                return;
            }
            
            if (!window.authManager.isAdmin()) {
                window.location.href = 'profile.html';
                return;
            }
            
            // User Mode functionality
            document.getElementById('userModeBtn').addEventListener('click', function() {
                if (confirm('Switch to User Mode? You can access the website as a regular customer for testing purposes.')) {
                    localStorage.setItem('adminMode', 'false');
                    window.location.href = 'index.html';
                }
            });

            // Initialize product management
            initializeProductManagement();
        });

        // Initialize product management functionality
        function initializeProductManagement() {
            // Load products
            loadProducts();
            
            // Event listeners
            document.getElementById('addProductBtn').addEventListener('click', showAddProductModal);
            document.getElementById('closeModalBtn').addEventListener('click', hideAddProductModal);
            document.getElementById('cancelBtn').addEventListener('click', hideAddProductModal);
            document.getElementById('refreshProductsBtn').addEventListener('click', loadProducts);
            document.getElementById('addProductForm').addEventListener('submit', handleAddProduct);
            document.getElementById('productImages').addEventListener('change', handleImageUpload);
            document.getElementById('addVariantBtn').addEventListener('click', addVariant);
            document.getElementById('productSearch').addEventListener('input', filterProducts);
            document.getElementById('categoryFilter').addEventListener('change', filterProducts);
            document.getElementById('statusFilter').addEventListener('change', filterProducts);
            
            // Bulk upload event listeners
            document.getElementById('bulkUploadBtn').addEventListener('click', showBulkUploadModal);
            document.getElementById('closeBulkModalBtn').addEventListener('click', hideBulkUploadModal);
            document.getElementById('cancelBulkBtn').addEventListener('click', hideBulkUploadModal);
            document.getElementById('excelFile').addEventListener('change', handleExcelFileUpload);
            document.getElementById('zipFile').addEventListener('change', handleZipFileUpload);
            document.getElementById('startBulkUploadBtn').addEventListener('click', startBulkUpload);
            document.getElementById('downloadTemplateBtn').addEventListener('click', downloadTemplate);
            
            // Bulk delete event listeners
            document.getElementById('bulkDeleteBtn').addEventListener('click', showBulkDeleteModal);
            document.getElementById('closeBulkDeleteModalBtn').addEventListener('click', hideBulkDeleteModal);
            document.getElementById('cancelBulkDeleteBtn').addEventListener('click', hideBulkDeleteModal);
            document.getElementById('confirmDeleteCheckbox').addEventListener('change', handleDeleteCheckboxChange);
            
            // Export event listeners (only for modal if it exists)
            const closeExportModalBtn = document.getElementById('closeExportModalBtn');
            const cancelExportBtn = document.getElementById('cancelExportBtn');
            const exportExcelBtn = document.getElementById('exportExcelBtn');
            const exportPdfBtn = document.getElementById('exportPdfBtn');
            
            if (closeExportModalBtn) closeExportModalBtn.addEventListener('click', closeExportModal);
            if (cancelExportBtn) cancelExportBtn.addEventListener('click', closeExportModal);
            if (exportExcelBtn) exportExcelBtn.addEventListener('click', handleExport);
            if (exportPdfBtn) exportPdfBtn.addEventListener('click', handleExport);
            document.getElementById('proceedDeleteBtn').addEventListener('click', proceedToDeleteStep2);
            document.getElementById('deleteConfirmationInput').addEventListener('input', handleDeleteConfirmationInput);
            document.getElementById('confirmDeleteBtn').addEventListener('click', confirmBulkDelete);
            
            // Edit modal event listeners
            document.getElementById('closeEditModalBtn').addEventListener('click', hideEditProductModal);
            document.getElementById('cancelEditBtn').addEventListener('click', hideEditProductModal);
            document.getElementById('editProductForm').addEventListener('submit', handleEditProduct);
            document.getElementById('editProductImages').addEventListener('change', handleEditImageUpload);
            document.getElementById('addEditVariantBtn').addEventListener('click', addEditVariant);
            

        }

        // Load products from API
        async function loadProducts() {
            try {
                const response = await fetch('/api/products?includeInactive=true&status=all&limit=1000');
                const data = await response.json();
                
                if (data.products) {
                    products = data.products;
                    filteredProducts = [...products];
                    displayProducts();
                    updateTotalProductsCount();
                } else {
                    console.error('Failed to load products:', data.error);
                    displayProducts([]);
                }
            } catch (error) {
                console.error('Error loading products:', error);
                displayProducts([]);
            }
        }

        // Display products in table
        function displayProducts(productsToShow = filteredProducts) {
            const tbody = document.getElementById('productsTableBody');
            
            if (productsToShow.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="px-6 py-12 text-center text-gray-500">
                            <svg class="w-16 h-16 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
                            </svg>
                            <h4 class="text-lg font-semibold text-gray-900 mb-2">No Products Found</h4>
                            <p class="text-gray-500">Start by adding your first product to the catalog.</p>
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = productsToShow.map(product => `
                <tr class="hover:bg-gray-50 transition-colors">
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 h-16 w-16">
                                ${product.images && product.images.length > 0 ? 
                                    `<img class="h-16 w-16 rounded-lg object-cover" src="${product.images[0]}" alt="${product.name}">` :
                                    `<div class="h-16 w-16 rounded-lg bg-gray-200 flex items-center justify-center">
                                        <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                        </svg>
                                    </div>`
                                }
                            </div>
                            <div class="ml-4">
                                <div class="text-sm font-medium text-gray-900">${product.name}</div>
                                <div class="text-sm text-gray-500">ID: ${product.productId}</div>
                                ${product.brand ? `<div class="text-sm text-gray-500">Brand: ${product.brand}</div>` : ''}
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                            ${product.category}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        <div class="font-medium">Rs. ${product.sellingPrice}</div>
                        ${product.discountPrice ? `<div class="text-xs text-gray-500 line-through">Rs. ${product.discountPrice}</div>` : ''}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${product.stock > 10 ? 'bg-green-100 text-green-800' : product.stock > 0 ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800'}">
                            ${product.stock} units
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${getStatusColor(product.status)}">
                            ${product.status}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                        <div class="flex space-x-2">
                            <button onclick="editProduct('${product._id}')" class="text-[#0ad167] hover:text-[#078829]">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                </svg>
                            </button>
                            <button onclick="deleteProduct('${product._id}')" class="text-red-600 hover:text-red-900">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                </svg>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // Get status color class
        function getStatusColor(status) {
            const statusColors = {
                'active': 'bg-green-100 text-green-800',
                'inactive': 'bg-yellow-100 text-yellow-800',
                'discontinued': 'bg-red-100 text-red-800'
            };
            return statusColors[status] || 'bg-gray-100 text-gray-800';
        }

        // Update total products count
        function updateTotalProductsCount() {
            const countElement = document.getElementById('totalProductsCount');
            if (countElement) {
                countElement.textContent = products.length;
            }
        }

        // Show add product modal
        function showAddProductModal() {
            document.getElementById('addProductModal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        // Hide add product modal
        function hideAddProductModal() {
            document.getElementById('addProductModal').classList.add('hidden');
            document.body.style.overflow = 'auto';
            resetForm();
        }

        // Reset form
        function resetForm() {
            document.getElementById('addProductForm').reset();
            uploadedImages = [];
            document.getElementById('imagePreview').classList.add('hidden');
            document.getElementById('imagePreview').innerHTML = '';
        }

        // Handle image upload
        function handleImageUpload(event) {
            const files = Array.from(event.target.files);
            uploadedImages = [...uploadedImages, ...files];
            displayImagePreviews();
        }

        // Display image previews
        function displayImagePreviews() {
            const previewContainer = document.getElementById('imagePreview');
            
            if (uploadedImages.length === 0) {
                previewContainer.classList.add('hidden');
                return;
            }

            previewContainer.classList.remove('hidden');
            previewContainer.innerHTML = uploadedImages.map((file, index) => `
                <div class="relative">
                    <img src="${URL.createObjectURL(file)}" alt="Preview ${index + 1}" class="w-full h-20 object-cover rounded-lg">
                    <button type="button" onclick="removeImage(${index})" class="absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs hover:bg-red-600">
                        ×
                    </button>
                </div>
            `).join('');
        }

        // Remove image
        function removeImage(index) {
            uploadedImages.splice(index, 1);
            displayImagePreviews();
        }

        // Add variant
        function addVariant() {
            const container = document.getElementById('variantsContainer');
            const variantDiv = document.createElement('div');
            variantDiv.className = 'flex space-x-3';
            variantDiv.innerHTML = `
                <input type="text" placeholder="Size" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#0ad167] focus:border-transparent">
                <input type="text" placeholder="Color" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#0ad167] focus:border-transparent">
                <button type="button" onclick="removeVariant(this)" class="px-3 py-2 text-red-600 hover:text-red-800">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                    </svg>
                </button>
            `;
            container.appendChild(variantDiv);
        }

        // Remove variant
        function removeVariant(button) {
            button.parentElement.remove();
        }

        // Handle add product form submission
        async function handleAddProduct(event) {
            event.preventDefault();
            
            // Prevent double submission
            const submitButton = document.getElementById('saveProductBtn');
            if (!submitButton || submitButton.disabled) {
                return; // Already processing or button not found
            }
            
            // Disable button and show loading state
            submitButton.disabled = true;
            const originalText = submitButton.innerHTML;
            submitButton.innerHTML = `
                <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                Adding Product...
            `;
            
            try {
                const formData = new FormData(event.target);
                const productData = {
                    productId: formData.get('productId'),
                    name: formData.get('name'),
                    category: formData.get('category'),
                    brand: formData.get('brand'),
                    sellingPrice: parseFloat(formData.get('sellingPrice')),
                    purchasePrice: parseFloat(formData.get('purchasePrice')),
                    stock: parseInt(formData.get('stock')),
                    description: formData.get('description'),
                    discountPrice: formData.get('discountPrice') ? parseFloat(formData.get('discountPrice')) : undefined,
                    status: formData.get('status'),
                    variants: getVariants(),
                    images: []
                };

                // Upload images first
                if (uploadedImages.length > 0) {
                    try {
                        submitButton.innerHTML = `
                            <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                            Uploading Images...
                        `;
                        
                        const imageUrls = await uploadImages(uploadedImages);
                        productData.images = imageUrls;
                    } catch (error) {
                        console.error('Error uploading images:', error);
                        alert('Error uploading images. Please try again.');
                        return;
                    }
                }

                // Submit product data
                submitButton.innerHTML = `
                    <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    Saving Product...
                `;
                
                const response = await fetch('/api/products', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(productData)
                });

                const result = await response.json();

                if (response.ok) {
                    alert('Product added successfully!');
                    hideAddProductModal();
                    loadProducts();
                } else {
                    alert('Error adding product: ' + (result.error || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error adding product:', error);
                alert('Error adding product. Please try again.');
            } finally {
                // Re-enable button
                if (submitButton) {
                    submitButton.disabled = false;
                    submitButton.innerHTML = originalText;
                }
            }
        }

        // Get variants from form
        function getVariants() {
            const container = document.getElementById('variantsContainer');
            const variants = [];
            
            Array.from(container.children).forEach(variantDiv => {
                const inputs = variantDiv.querySelectorAll('input');
                if (inputs.length >= 2 && (inputs[0].value || inputs[1].value)) {
                    variants.push({
                        size: inputs[0].value,
                        color: inputs[1].value
                    });
                }
            });
            
            return variants;
        }

        // Upload images
        async function uploadImages(files) {
            const uploadPromises = files.map(async (file) => {
                const formData = new FormData();
                formData.append('image', file);
                
                const response = await fetch('/api/products/upload-image', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                if (response.ok) {
                    return result.imageUrl;
                } else {
                    throw new Error(result.error || 'Upload failed');
                }
            });
            
            return Promise.all(uploadPromises);
        }

        // Filter products
        function filterProducts() {
            const searchTerm = document.getElementById('productSearch').value.toLowerCase();
            const categoryFilter = document.getElementById('categoryFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;
            
            filteredProducts = products.filter(product => {
                // Enhanced search with singular/plural handling
                let matchesSearch = !searchTerm;
                if (searchTerm) {
                    const productName = product.name.toLowerCase();
                    const productId = product.productId.toLowerCase();
                    const productBrand = product.brand?.toLowerCase() || '';
                    const productDescription = product.description?.toLowerCase() || '';
                    const productCategory = product.category.toLowerCase();
                    
                    // Direct matches
                    matchesSearch = productName.includes(searchTerm) ||
                                   productId.includes(searchTerm) ||
                                   productBrand.includes(searchTerm) ||
                                   productDescription.includes(searchTerm) ||
                                   productCategory.includes(searchTerm);
                    
                    // Handle singular/plural category matching
                    if (!matchesSearch) {
                        const categoryMappings = {
                            'books': 'book',
                            'book': 'books',
                            'pens': 'pen',
                            'pen': 'pens',
                            'toys': 'toy',
                            'toy': 'toys'
                        };
                        
                        const mappedCategory = categoryMappings[searchTerm];
                        if (mappedCategory && productCategory.includes(mappedCategory)) {
                            matchesSearch = true;
                        }
                    }
                }
                
                const matchesCategory = !categoryFilter || product.category === categoryFilter;
                const matchesStatus = !statusFilter || product.status === statusFilter;
                
                return matchesSearch && matchesCategory && matchesStatus;
            });
            
            displayProducts();
        }

        // Edit product
        async function editProduct(productId) {
            try {
                // Find the product in the current products array
                const product = products.find(p => p._id === productId);
                if (!product) {
                    alert('Product not found!');
                    return;
                }

                currentEditingProduct = product;
                
                // Populate the edit form with product data
                document.getElementById('editProductId').value = product._id;
                document.getElementById('editProductIdField').value = product.productId;
                document.getElementById('editProductName').value = product.name;
                document.getElementById('editProductCategory').value = product.category;
                document.getElementById('editProductBrand').value = product.brand || '';
                document.getElementById('editSellingPrice').value = product.sellingPrice;
                document.getElementById('editPurchasePrice').value = product.purchasePrice;
                document.getElementById('editStock').value = product.stock;
                document.getElementById('editDiscountPrice').value = product.discountPrice || '';
                document.getElementById('editProductDescription').value = product.description || '';
                document.getElementById('editProductStatus').value = product.status;

                // Load current images
                loadCurrentImages(product.images || []);
                
                // Load variants
                loadEditVariants(product.variants || []);
                
                // Reset new image uploads
                editUploadedImages = [];
                document.getElementById('editImagePreview').classList.add('hidden');
                document.getElementById('editImagePreview').innerHTML = '';
                
                // Show the edit modal
                showEditProductModal();
                
            } catch (error) {
                console.error('Error loading product for edit:', error);
                alert('Error loading product for editing. Please try again.');
            }
        }

        // Delete product
        async function deleteProduct(productId) {
            if (confirm('Are you sure you want to delete this product?')) {
                try {
                    const response = await fetch(`/api/products/${productId}`, {
                        method: 'DELETE'
                    });
                    
                    if (response.ok) {
                        alert('Product deleted successfully!');
                        loadProducts();
                    } else {
                        const result = await response.json();
                        alert('Error deleting product: ' + (result.error || 'Unknown error'));
                    }
                } catch (error) {
                    console.error('Error deleting product:', error);
                    alert('Error deleting product. Please try again.');
                }
            }
        }

        // Show edit product modal
        function showEditProductModal() {
            document.getElementById('editProductModal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        // Hide edit product modal
        function hideEditProductModal() {
            document.getElementById('editProductModal').classList.add('hidden');
            document.body.style.overflow = 'auto';
            resetEditForm();
        }

        // Reset edit form
        function resetEditForm() {
            document.getElementById('editProductForm').reset();
            editUploadedImages = [];
            currentEditingProduct = null;
            document.getElementById('editImagePreview').classList.add('hidden');
            document.getElementById('editImagePreview').innerHTML = '';
            document.getElementById('currentImagesContainer').innerHTML = '';
            document.getElementById('editVariantsContainer').innerHTML = '';
        }

        // Load current images for edit
        function loadCurrentImages(images) {
            const container = document.getElementById('currentImagesContainer');
            
            if (images.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-sm">No images</p>';
                return;
            }

            container.innerHTML = images.map((imageUrl, index) => `
                <div class="relative">
                    <img src="${imageUrl}" alt="Current image ${index + 1}" class="w-full h-20 object-cover rounded-lg">
                    <button type="button" onclick="removeCurrentImage(${index})" class="absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs hover:bg-red-600">
                        ×
                    </button>
                </div>
            `).join('');
        }

        // Remove current image
        function removeCurrentImage(index) {
            if (currentEditingProduct && currentEditingProduct.images) {
                currentEditingProduct.images.splice(index, 1);
                loadCurrentImages(currentEditingProduct.images);
            }
        }

        // Handle edit image upload
        function handleEditImageUpload(event) {
            const files = Array.from(event.target.files);
            editUploadedImages = [...editUploadedImages, ...files];
            displayEditImagePreviews();
        }

        // Display edit image previews
        function displayEditImagePreviews() {
            const previewContainer = document.getElementById('editImagePreview');
            
            if (editUploadedImages.length === 0) {
                previewContainer.classList.add('hidden');
                return;
            }

            previewContainer.classList.remove('hidden');
            previewContainer.innerHTML = editUploadedImages.map((file, index) => `
                <div class="relative">
                    <img src="${URL.createObjectURL(file)}" alt="New preview ${index + 1}" class="w-full h-20 object-cover rounded-lg">
                    <button type="button" onclick="removeEditImage(${index})" class="absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs hover:bg-red-600">
                        ×
                    </button>
                </div>
            `).join('');
        }

        // Remove edit image
        function removeEditImage(index) {
            editUploadedImages.splice(index, 1);
            displayEditImagePreviews();
        }

        // Load edit variants
        function loadEditVariants(variants) {
            const container = document.getElementById('editVariantsContainer');
            
            if (variants.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-sm">No variants</p>';
                return;
            }

            container.innerHTML = variants.map((variant, index) => `
                <div class="flex space-x-3">
                    <input type="text" placeholder="Size" value="${variant.size || ''}" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#0ad167] focus:border-transparent">
                    <input type="text" placeholder="Color" value="${variant.color || ''}" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#0ad167] focus:border-transparent">
                    <button type="button" onclick="removeEditVariant(this)" class="px-3 py-2 text-red-600 hover:text-red-800">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                        </svg>
                    </button>
                </div>
            `).join('');
        }

        // Add edit variant
        function addEditVariant() {
            const container = document.getElementById('editVariantsContainer');
            const variantDiv = document.createElement('div');
            variantDiv.className = 'flex space-x-3';
            variantDiv.innerHTML = `
                <input type="text" placeholder="Size" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#0ad167] focus:border-transparent">
                <input type="text" placeholder="Color" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#0ad167] focus:border-transparent">
                <button type="button" onclick="removeEditVariant(this)" class="px-3 py-2 text-red-600 hover:text-red-800">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                    </svg>
                </button>
            `;
            container.appendChild(variantDiv);
        }

        // Remove edit variant
        function removeEditVariant(button) {
            button.parentElement.remove();
        }

        // Handle edit product form submission
        async function handleEditProduct(event) {
            event.preventDefault();
            
            // Prevent double submission
            const submitButton = document.getElementById('updateProductBtn');
            if (!submitButton || submitButton.disabled) {
                return; // Already processing or button not found
            }
            
            // Disable button and show loading state
            submitButton.disabled = true;
            const originalText = submitButton.innerHTML;
            submitButton.innerHTML = `
                <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                Updating Product...
            `;
            
            try {
                const formData = new FormData(event.target);
                const productId = document.getElementById('editProductId').value;
            
                const productData = {
                    productId: formData.get('productId'),
                    name: formData.get('name'),
                    category: formData.get('category'),
                    brand: formData.get('brand'),
                    sellingPrice: parseFloat(formData.get('sellingPrice')),
                    purchasePrice: parseFloat(formData.get('purchasePrice')),
                    stock: parseInt(formData.get('stock')),
                    description: formData.get('description'),
                    discountPrice: formData.get('discountPrice') ? parseFloat(formData.get('discountPrice')) : undefined,
                    status: formData.get('status'),
                    variants: getEditVariants(),
                    images: currentEditingProduct ? [...(currentEditingProduct.images || [])] : []
                };

                // Upload new images if any
                if (editUploadedImages.length > 0) {
                    try {
                        const imageUrls = await uploadImages(editUploadedImages);
                        productData.images = [...productData.images, ...imageUrls];
                    } catch (error) {
                        console.error('Error uploading new images:', error);
                        alert('Error uploading new images. Please try again.');
                        return;
                    }
                }

                // Update product data
                const response = await fetch(`/api/products/${productId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(productData)
                });

                const result = await response.json();

                if (response.ok) {
                    alert('Product updated successfully!');
                    hideEditProductModal();
                    loadProducts();
                } else {
                    alert('Error updating product: ' + (result.error || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error updating product:', error);
                alert('Error updating product. Please try again.');
            } finally {
                // Re-enable button
                if (submitButton) {
                    submitButton.disabled = false;
                    submitButton.innerHTML = originalText;
                }
            }
        }

        // Get edit variants from form
        function getEditVariants() {
            const container = document.getElementById('editVariantsContainer');
            const variants = [];
            
            Array.from(container.children).forEach(variantDiv => {
                const inputs = variantDiv.querySelectorAll('input');
                if (inputs.length >= 2 && (inputs[0].value || inputs[1].value)) {
                    variants.push({
                        size: inputs[0].value,
                        color: inputs[1].value
                    });
                }
            });
            
            return variants;
        }

        // Logout function
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                // Clear all authentication data
                localStorage.removeItem('authToken');
                localStorage.removeItem('userData');
                localStorage.removeItem('adminMode');
                // Redirect to main website as new user
                window.location.href = 'index.html';
            }
        }

        // ==================== BULK UPLOAD FUNCTIONALITY ====================
        
        // Global variables for bulk upload
        let bulkUploadData = {
            excelFile: null,
            zipFile: null,
            isUploading: false
        };

        // Show bulk upload modal
        function showBulkUploadModal() {
            document.getElementById('bulkUploadModal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            resetBulkUploadForm();
        }

        // Hide bulk upload modal
        function hideBulkUploadModal() {
            if (bulkUploadData.isUploading) {
                if (!confirm('Upload is in progress. Are you sure you want to cancel?')) {
                    return;
                }
            }
            document.getElementById('bulkUploadModal').classList.add('hidden');
            document.body.style.overflow = 'auto';
            resetBulkUploadForm();
        }

        // Reset bulk upload form
        function resetBulkUploadForm() {
            bulkUploadData.excelFile = null;
            bulkUploadData.zipFile = null;
            bulkUploadData.isUploading = false;
            
            document.getElementById('excelFile').value = '';
            document.getElementById('zipFile').value = '';
            document.getElementById('excelFileInfo').classList.add('hidden');
            document.getElementById('zipFileInfo').classList.add('hidden');
            document.getElementById('startBulkUploadBtn').disabled = true;
            document.getElementById('uploadProgress').classList.add('hidden');
            document.getElementById('uploadResults').classList.add('hidden');
        }

        // Handle Excel file upload
        function handleExcelFileUpload(event) {
            const file = event.target.files[0];
            if (file) {
                bulkUploadData.excelFile = file;
                const fileInfo = document.getElementById('excelFileInfo');
                fileInfo.innerHTML = `
                    <div class="flex items-center space-x-2 text-green-600">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <span>${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)</span>
                    </div>
                `;
                fileInfo.classList.remove('hidden');
                checkBulkUploadReady();
            }
        }

        // Handle ZIP file upload
        function handleZipFileUpload(event) {
            const file = event.target.files[0];
            if (file) {
                bulkUploadData.zipFile = file;
                const fileInfo = document.getElementById('zipFileInfo');
                fileInfo.innerHTML = `
                    <div class="flex items-center space-x-2 text-green-600">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <span>${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)</span>
                    </div>
                `;
                fileInfo.classList.remove('hidden');
                checkBulkUploadReady();
            }
        }

        // Check if both files are ready for upload
        function checkBulkUploadReady() {
            const startBtn = document.getElementById('startBulkUploadBtn');
            if (bulkUploadData.excelFile && bulkUploadData.zipFile) {
                startBtn.disabled = false;
            } else {
                startBtn.disabled = true;
            }
        }

        // Download Excel template
        function downloadTemplate() {
            // Create a simple CSV template that can be opened in Excel
            const templateData = [
                ['productId', 'name', 'category', 'brand', 'sellingPrice', 'purchasePrice', 'stock', 'discountPrice', 'description', 'status'],
                ['PROD-001', 'Sample Product Name', 'books', 'Sample Brand', '100.00', '80.00', '50', '0', 'Sample product description', 'active'],
                ['PROD-002', 'Another Product', 'pens', 'Another Brand', '25.00', '20.00', '100', '0', 'Another sample description', 'active']
            ];
            
            const csvContent = templateData.map(row => row.join(',')).join('\n');
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', 'product_bulk_upload_template.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Start bulk upload process
        async function startBulkUpload() {
            if (!bulkUploadData.excelFile || !bulkUploadData.zipFile) {
                alert('Please select both Excel and ZIP files before starting upload.');
                return;
            }

            bulkUploadData.isUploading = true;
            document.getElementById('startBulkUploadBtn').disabled = true;
            document.getElementById('uploadProgress').classList.remove('hidden');
            document.getElementById('uploadResults').classList.add('hidden');

            try {
                // Show initial progress
                updateProgress(0, 'Preparing files for upload...');
                addToLog('Starting bulk upload process...');

                // Create FormData for file upload
                const formData = new FormData();
                formData.append('excelFile', bulkUploadData.excelFile);
                formData.append('zipFile', bulkUploadData.zipFile);

                // Upload files to backend
                updateProgress(10, 'Uploading files to server...');
                addToLog('Uploading Excel and ZIP files...');

                const response = await fetch('/api/products/bulk-upload', {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();

                if (result.success) {
                    updateProgress(100, 'Upload completed successfully!');
                    addToLog('✅ Bulk upload completed successfully!');
                    showUploadResults(result.data);
                } else {
                    throw new Error(result.error || 'Upload failed');
                }

            } catch (error) {
                console.error('Bulk upload error:', error);
                updateProgress(0, 'Upload failed');
                addToLog(`❌ Error: ${error.message}`);
                alert('Bulk upload failed: ' + error.message);
            } finally {
                bulkUploadData.isUploading = false;
                document.getElementById('startBulkUploadBtn').disabled = false;
            }
        }

        // Update progress bar and text
        function updateProgress(percent, text) {
            document.getElementById('progressBar').style.width = percent + '%';
            document.getElementById('progressPercent').textContent = percent + '%';
            document.getElementById('progressText').textContent = text;
        }

        // Add message to upload log
        function addToLog(message) {
            const logContainer = document.getElementById('uploadLog');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = 'mb-1 text-gray-700';
            logEntry.textContent = `[${timestamp}] ${message}`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        // Show upload results
        function showUploadResults(data) {
            document.getElementById('uploadResults').classList.remove('hidden');
            
            // Update counts
            document.getElementById('successCount').textContent = data.successful || 0;
            document.getElementById('errorCount').textContent = data.failed || 0;
            document.getElementById('warningCount').textContent = data.warnings || 0;

            // Show detailed results
            const detailsContainer = document.getElementById('detailedResults');
            let detailsHtml = '';

            if (data.successful > 0) {
                detailsHtml += '<div class="mb-3"><h5 class="font-medium text-green-700 mb-2">✅ Successful Products:</h5>';
                if (data.successfulProducts) {
                    detailsHtml += '<ul class="text-sm text-green-600 space-y-1">';
                    data.successfulProducts.forEach(product => {
                        detailsHtml += `<li>• ${product.name} (${product.productId})</li>`;
                    });
                    detailsHtml += '</ul>';
                }
                detailsHtml += '</div>';
            }

            if (data.failed > 0) {
                detailsHtml += '<div class="mb-3"><h5 class="font-medium text-red-700 mb-2">❌ Failed Products:</h5>';
                if (data.failedProducts) {
                    detailsHtml += '<ul class="text-sm text-red-600 space-y-1">';
                    data.failedProducts.forEach(product => {
                        detailsHtml += `<li>• ${product.name}: ${product.error}</li>`;
                    });
                    detailsHtml += '</ul>';
                }
                detailsHtml += '</div>';
            }

            if (data.warnings > 0) {
                detailsHtml += '<div class="mb-3"><h5 class="font-medium text-yellow-700 mb-2">⚠️ Warnings:</h5>';
                if (data.warningMessages) {
                    detailsHtml += '<ul class="text-sm text-yellow-600 space-y-1">';
                    data.warningMessages.forEach(warning => {
                        detailsHtml += `<li>• ${warning}</li>`;
                    });
                    detailsHtml += '</ul>';
                }
                detailsHtml += '</div>';
            }

            detailsContainer.innerHTML = detailsHtml;

            // Refresh products list if any were successfully added
            if (data.successful > 0) {
                setTimeout(() => {
                    loadProducts();
                }, 1000);
            }
        }






        

        // ==================== BULK DELETE FUNCTIONALITY ====================
        
        // Global variables for bulk delete
        let bulkDeleteData = {
            isDeleting: false,
            totalProducts: 0
        };

        // Show bulk delete modal
        function showBulkDeleteModal() {
            bulkDeleteData.totalProducts = products.length;
            document.getElementById('deleteCount').textContent = `${bulkDeleteData.totalProducts} products`;
            document.getElementById('finalDeleteCount').textContent = `${bulkDeleteData.totalProducts} products`;
            
            document.getElementById('bulkDeleteModal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            resetBulkDeleteForm();
        }

        // Hide bulk delete modal
        function hideBulkDeleteModal() {
            if (bulkDeleteData.isDeleting) {
                if (!confirm('Deletion is in progress. Are you sure you want to cancel?')) {
                    return;
                }
            }
            document.getElementById('bulkDeleteModal').classList.add('hidden');
            document.body.style.overflow = 'auto';
            resetBulkDeleteForm();
        }

        // Reset bulk delete form
        function resetBulkDeleteForm() {
            bulkDeleteData.isDeleting = false;
            
            // Reset form elements
            document.getElementById('confirmDeleteCheckbox').checked = false;
            document.getElementById('deleteConfirmationInput').value = '';
            document.getElementById('proceedDeleteBtn').disabled = true;
            document.getElementById('confirmDeleteBtn').disabled = true;
            
            // Show/hide sections
            document.getElementById('deleteStep1').classList.remove('hidden');
            document.getElementById('deleteStep2').classList.add('hidden');
            document.getElementById('deleteProgress').classList.add('hidden');
            document.getElementById('deleteResults').classList.add('hidden');
            
            // Show/hide buttons
            document.getElementById('proceedDeleteBtn').classList.remove('hidden');
            document.getElementById('confirmDeleteBtn').classList.add('hidden');
        }

        // Handle delete checkbox change
        function handleDeleteCheckboxChange() {
            const checkbox = document.getElementById('confirmDeleteCheckbox');
            const proceedBtn = document.getElementById('proceedDeleteBtn');
            proceedBtn.disabled = !checkbox.checked;
        }

        // Proceed to delete step 2
        function proceedToDeleteStep2() {
            document.getElementById('deleteStep1').classList.add('hidden');
            document.getElementById('deleteStep2').classList.remove('hidden');
            document.getElementById('proceedDeleteBtn').classList.add('hidden');
            document.getElementById('confirmDeleteBtn').classList.remove('hidden');
        }

        // Handle delete confirmation input
        function handleDeleteConfirmationInput() {
            const input = document.getElementById('deleteConfirmationInput');
            const confirmBtn = document.getElementById('confirmDeleteBtn');
            const expectedText = 'DELETE ALL PRODUCTS';
            
            confirmBtn.disabled = input.value !== expectedText;
        }

        // Confirm bulk delete
        async function confirmBulkDelete() {
            if (bulkDeleteData.isDeleting) return;
            
            bulkDeleteData.isDeleting = true;
            document.getElementById('confirmDeleteBtn').disabled = true;
            document.getElementById('deleteStep2').classList.add('hidden');
            document.getElementById('deleteProgress').classList.remove('hidden');
            document.getElementById('deleteResults').classList.add('hidden');

            try {
                // Show initial progress
                updateDeleteProgress(0, 'Starting bulk deletion...');
                addToDeleteLog('Starting bulk delete process...');

                // Call bulk delete API
                updateDeleteProgress(10, 'Connecting to server...');
                addToDeleteLog('Connecting to server...');

                const response = await fetch('/api/products/bulk-delete', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();

                if (result.success) {
                    updateDeleteProgress(100, 'Deletion completed successfully!');
                    addToDeleteLog('✅ Bulk delete completed successfully!');
                    showDeleteResults(result.data);
                    
                    // Refresh products list
                    setTimeout(() => {
                        loadProducts();
                    }, 1000);
                } else {
                    throw new Error(result.error || 'Deletion failed');
                }

            } catch (error) {
                console.error('Bulk delete error:', error);
                updateDeleteProgress(0, 'Deletion failed');
                addToDeleteLog(`❌ Error: ${error.message}`);
                alert('Bulk delete failed: ' + error.message);
            } finally {
                bulkDeleteData.isDeleting = false;
                document.getElementById('confirmDeleteBtn').disabled = false;
            }
        }

        // Update delete progress bar and text
        function updateDeleteProgress(percent, text) {
            document.getElementById('deleteProgressBar').style.width = percent + '%';
            document.getElementById('deleteProgressPercent').textContent = percent + '%';
            document.getElementById('deleteProgressText').textContent = text;
        }

        // Add message to delete log
        function addToDeleteLog(message) {
            const logContainer = document.getElementById('deleteLog');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = 'mb-1 text-gray-700';
            logEntry.textContent = `[${timestamp}] ${message}`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        // Show delete results
        function showDeleteResults(data) {
            document.getElementById('deleteResults').classList.remove('hidden');
            
            // Update counts
            document.getElementById('deletedCount').textContent = data.deletedProducts || 0;
            document.getElementById('imagesDeletedCount').textContent = data.deletedImages || 0;
            
            // Show Cloudinary folder cleanup if applicable
            if (data.cloudinaryFolderDeleted > 0) {
                const cloudinaryInfo = document.createElement('div');
                cloudinaryInfo.className = 'mt-2 p-2 bg-blue-50 border border-blue-200 rounded text-sm text-blue-700';
                cloudinaryInfo.innerHTML = `🧹 Also cleaned up ${data.cloudinaryFolderDeleted} images from Cloudinary folder`;
                document.getElementById('deleteResults').appendChild(cloudinaryInfo);
            }
        }

        // Export functionality
        let currentExportType = null;

        function openExportModal(type) {
            currentExportType = type;
            const modal = document.getElementById('exportFormatModal');
            const title = document.getElementById('exportModalTitle');
            const description = document.getElementById('exportModalDescription');
            
            if (type === 'catalog') {
                title.textContent = 'Export Book Catalog';
                description.textContent = 'Choose the format for your book catalog export:';
            } else if (type === 'low-stock') {
                title.textContent = 'Export Low Stock Report';
                description.textContent = 'Choose the format for your low stock report export:';
            }
            
            modal.classList.remove('hidden');
        }

        function closeExportModal() {
            document.getElementById('exportFormatModal').classList.add('hidden');
            currentExportType = null;
        }

        async function handleExport(event) {
            const format = event.target.id === 'exportExcelBtn' ? 'excel' : 'pdf';
            const button = event.target;
            const originalText = button.innerHTML;
            
            try {
                // Show loading state
                button.innerHTML = `
                    <svg class="w-5 h-5 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                    </svg>
                    <span>Exporting...</span>
                `;
                button.disabled = true;

                // Determine the API endpoint
                let endpoint;
                if (currentExportType === 'catalog') {
                    endpoint = format === 'excel' ? '/api/products/export/catalog/excel' : '/api/products/export/catalog/pdf';
                } else if (currentExportType === 'low-stock') {
                    endpoint = format === 'excel' ? '/api/products/export/low-stock/excel' : '/api/products/export/low-stock/pdf';
                }

                // Make API call
                const response = await fetch(endpoint, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    }
                });

                if (!response.ok) {
                    throw new Error(`Failed to export ${currentExportType} as ${format}`);
                }

                // Get the file content
                const fileContent = await response.blob();
                const contentType = response.headers.get('content-type');
                
                // Determine file extension
                const fileExtension = format === 'excel' ? 'xlsx' : 'html';
                
                // Create and download the file
                const url = window.URL.createObjectURL(fileContent);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${currentExportType}_export_${new Date().toISOString().split('T')[0]}.${fileExtension}`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);

                // Show success message
                showNotification(`${currentExportType} exported successfully as ${format.toUpperCase()}!`, 'success');
                
                // Close modal
                closeExportModal();

            } catch (error) {
                console.error('Export error:', error);
                showNotification(`Failed to export ${currentExportType}. Please try again.`, 'error');
            } finally {
                // Restore button state
                button.innerHTML = originalText;
                button.disabled = false;
            }
        }

        // Notification function
        function showNotification(message, type = 'info') {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg max-w-sm ${
                type === 'success' ? 'bg-green-500 text-white' :
                type === 'error' ? 'bg-red-500 text-white' :
                type === 'warning' ? 'bg-yellow-500 text-white' :
                'bg-blue-500 text-white'
            }`;
            
            notification.innerHTML = `
                <div class="flex items-center space-x-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        ${type === 'success' ? '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>' :
                          type === 'error' ? '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>' :
                          type === 'warning' ? '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>' :
                          '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>'}
                    </svg>
                    <span>${message}</span>
                </div>
            `;
            
            // Add to page
            document.body.appendChild(notification);
            
            // Remove after 5 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 5000);
        }
    </script>
    
    <!-- Enhanced Export Script -->
    <script src="/javascript/enhancedExport.js"></script>
</body>
</html>