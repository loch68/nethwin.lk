<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Detail - NethwinLK</title>
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="" />
    <link
      rel="stylesheet"
      as="style"
      onload="this.rel='stylesheet'"
      href="https://fonts.googleapis.com/css2?display=swap&amp;family=Inter%3Awght%40400%3B500%3B700%3B900&amp;family=Noto+Sans%3Awght%40400%3B500%3B700%3B900"
    />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link rel="stylesheet" href="../css/hover-effects.css" />
    <style>
        .quantity-btn {
            transition: all 0.2s ease-in-out;
        }
        .quantity-btn:hover {
            background-color: #19e619;
            color: white;
        }
    </style>
  <link rel="stylesheet" href="../css/responsive.css" />
</head>
<body>
    <div class="relative flex min-h-screen flex-col bg-white overflow-x-hidden font-[Inter, 'Noto Sans', sans-serif]">
        <div class="layout-container flex flex-col grow h-full">
        
        <!-- Header -->
        <header class="flex items-center justify-between whitespace-nowrap border-b border-solid border-b-[#f2f4f1] px-10 py-3">
            <div class="flex items-center gap-4 text-[#111418]">
                <div class="h-10">
                    <a href="index.html" aria-label="Go to Home">
                        <img src="../assets/fLogo.png" alt="NETHWIN Logo" class="h-10 w-auto" />
                    </a>
                </div>
            </div>
            <div class="flex flex-1 justify-end gap-8">
                <div class="flex items-center gap-9">
                    <a class="text-[#151612] text-sm font-medium leading-normal transition-all duration-300 ease-in-out hover:text-[#0ad167] hover:scale-105 hover:drop-shadow-sm relative group" href="print.html">Print on Demand<span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-[#0ad167] transition-all duration-300 group-hover:w-full"></span></a>
                    <a class="text-[#151612] text-sm font-medium leading-normal transition-all duration-300 ease-in-out hover:text-[#0ad167] hover:scale-105 hover:drop-shadow-sm relative group" href="agency.html">Advertising Agency<span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-[#0ad167] transition-all duration-300 group-hover:w-full"></span></a>
                    <a class="text-[#151612] text-sm font-medium leading-normal transition-all duration-300 ease-in-out hover:text-[#0ad167] hover:scale-105 hover:drop-shadow-sm relative group" href="contactus.html">Contact Us<span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-[#0ad167] transition-all duration-300 group-hover:w-full"></span></a>
                    <a class="text-[#151612] text-sm font-medium leading-normal transition-all duration-300 ease-in-out hover:text-[#0ad167] hover:scale-105 hover:drop-shadow-sm relative group" href="aboutus.html">About Us<span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-[#0ad167] transition-all duration-300 group-hover:w-full"></span></a>
                </div>
                <div class="flex gap-2">
                    <button class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-full h-10 px-4 bg-[#0ad167] text-[#151612] text-sm font-bold leading-normal tracking-[0.015em] transition-all duration-300 ease-in-out hover:bg-[#08b85a] hover:scale-105 hover:shadow-lg hover:shadow-[#0ad167]/25">
                        <a href="login.html"><span class="truncate">Login</span></a>
                    </button>
                    <a href="cart.html">
                        <button class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-full h-10 px-4 bg-[#f2f4f1] text-[#151612] text-sm font-bold leading-normal tracking-[0.015em] transition-all duration-300 ease-in-out hover:bg-[#e8ebe8] hover:scale-105 hover:shadow-md">
                            <span class="truncate">Cart</span>
                        </button>
                    </a>
                    <a href="search.html">
                        <button class="flex max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-full h-10 bg-[#f2f4f1] text-[#151612] gap-2 text-sm font-bold leading-normal tracking-[0.015em] min-w-0 px-2.5 transition-all duration-300 ease-in-out hover:bg-[#e8ebe8] hover:scale-105 hover:shadow-md">
                            <div class="text-[#151612]" data-icon="MagnifyingGlass" data-size="20px" data-weight="regular">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" fill="currentColor" viewBox="0 0 256 256">
                                    <path d="M229.66,218.34l-50.07-50.06a88.11,88.11,0,1,0-11.31,11.31l50.06,50.07a8,8,0,0,0,11.32-11.32ZM40,112a72,72,0,1,1,72,72A72.08,72.08,0,0,1,40,112Z"></path>
                                </svg>
                            </div>
                        </button>
                    </a>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <div class="px-4 md:px-10 flex flex-1 justify-center py-5">
            <div class="layout-content-container flex flex-col max-w-[1200px] flex-1">
                <!-- Breadcrumb -->
                <nav class="mb-8">
                    <ol class="flex items-center space-x-2 text-sm text-[#51946c]">
                        <li><a href="index.html" class="hover:text-[#19e619]">Home</a></li>
                        <li><span class="mx-2">/</span></li>
                        <li><a href="bookshop.html" class="hover:text-[#19e619]">Shop</a></li>
                        <li><span class="mx-2">/</span></li>
                        <li class="text-[#0e1a13] font-medium" id="productNameBreadcrumb">Product</li>
                    </ol>
                </nav>

                <!-- Product Details -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
                    <!-- Product Image -->
                    <div class="space-y-4">
                        <div class="aspect-square bg-white rounded-lg border border-[#d1e6d9] overflow-hidden">
                            <img id="productImage" src="" alt="Product" class="w-full h-full object-cover">
                        </div>
                        <div class="flex gap-2">
                            <button class="w-20 h-20 bg-white border border-[#d1e6d9] rounded-lg overflow-hidden hover:border-[#19e619] transition-colors">
                                <img id="productImageThumb1" src="" alt="Thumbnail 1" class="w-full h-full object-cover">
                            </button>
                            <button class="w-20 h-20 bg-white border border-[#d1e6d9] rounded-lg overflow-hidden hover:border-[#19e619] transition-colors">
                                <img id="productImageThumb2" src="" alt="Thumbnail 2" class="w-full h-full object-cover">
                            </button>
                            <button class="w-20 h-20 bg-white border border-[#d1e6d9] rounded-lg overflow-hidden hover:border-[#19e619] transition-colors">
                                <img id="productImageThumb3" src="" alt="Thumbnail 3" class="w-full h-full object-cover">
                            </button>
                        </div>
                    </div>

                    <!-- Product Info -->
                    <div class="space-y-6">
                        <div>
                            <h1 id="productTitle" class="text-3xl font-bold text-[#0e1a13] mb-2">Product Title</h1>
                            <p id="productSKU" class="text-[#51946c] text-sm">SKU: BOOK-001</p>
                        </div>

                        <div class="flex items-center gap-4">
                            <span id="productPrice" class="text-3xl font-bold text-[#19e619]">LKR 12.99</span>
                            <span id="productOriginalPrice" class="text-xl text-[#51946c] line-through">LKR 15.99</span>
                            <span id="productDiscount" class="bg-[#19e619] text-white px-2 py-1 rounded text-sm font-medium">-20%</span>
                        </div>

                        <div>
                            <p id="productDescription" class="text-[#0e1a13] leading-relaxed">
                                Product description will be loaded here...
                            </p>
                        </div>

                        <div class="space-y-4">
                            <div class="flex items-center gap-4">
                                <span class="text-[#0e1a13] font-medium">Availability:</span>
                                <span id="productAvailability" class="text-[#19e619] font-medium">In Stock</span>
                            </div>
                            <div class="flex items-center gap-4">
                                <span class="text-[#0e1a13] font-medium">Brand:</span>
                                <span id="productBrand" class="text-[#51946c]">Brand Name</span>
                            </div>
                            <div class="flex items-center gap-4">
                                <span class="text-[#0e1a13] font-medium">Category:</span>
                                <span id="productCategory" class="text-[#51946c]">Books</span>
                            </div>
                        </div>

                        <!-- Quantity Selector -->
                        <div class="space-y-3">
                            <label class="text-[#0e1a13] font-medium">Quantity:</label>
                            <div class="flex items-center gap-2">
                                <div class="flex items-center bg-gradient-to-r from-[#f8faf8] to-[#f0f4f0] border border-[#d1e6d9] rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-all duration-300">
                                    <button onclick="changeQuantityDetail(-1)" class="px-2 py-1.5 bg-gradient-to-r from-[#e8f2ec] to-[#d1e6d9] text-[#151612] hover:from-[#19e619] hover:to-[#0ad167] hover:text-white transition-all duration-300 text-sm font-bold flex items-center justify-center min-w-[32px]">−</button>
                                    <span id="quantityDetail" class="flex-1 text-center py-1.5 text-sm font-bold text-[#151612] bg-white min-w-[40px]">1</span>
                                    <button onclick="changeQuantityDetail(1)" class="px-2 py-1.5 bg-gradient-to-r from-[#e8f2ec] to-[#d1e6d9] text-[#151612] hover:from-[#19e619] hover:to-[#0ad167] hover:text-white transition-all duration-300 text-sm font-bold flex items-center justify-center min-w-[32px]">+</button>
                                </div>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="flex gap-4">
                            <button id="addToCartBtn" class="flex-1 bg-[#19e619] text-white py-4 px-6 rounded-lg font-semibold hover:bg-green-600 transition-colors flex items-center justify-center gap-2">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-2.5 5M7 13l2.5 5m6-5v6a2 2 0 01-2 2H9a2 2 0 01-2-2v-6m6 0V9a2 2 0 00-2-2H9a2 2 0 00-2 2v4.01"></path>
                                </svg>
                                Add to Cart
                            </button>
                            <button id="buyNowBtn" class="flex-1 bg-[#0e1a13] text-white py-4 px-6 rounded-lg font-semibold hover:bg-gray-800 transition-colors">
                                Buy Now
                            </button>
                        </div>

                        <!-- Total Price -->
                        <div class="bg-[#e8f2ec] p-4 rounded-lg">
                            <div class="flex justify-between items-center">
                                <span class="text-[#0e1a13] font-medium">Total Price:</span>
                                <span id="totalPrice" class="text-2xl font-bold text-[#19e619]">LKR 12.99</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Additional Information -->
                <div class="mt-16">
                    <div class="border-b border-[#d1e6d9]">
                        <nav class="flex space-x-8">
                            <button class="tab-btn active py-4 px-1 border-b-2 border-[#19e619] text-[#19e619] font-medium" data-tab="description">
                                Description
                            </button>
                            <button class="tab-btn py-4 px-1 border-b-2 border-transparent text-[#51946c] font-medium" data-tab="specifications">
                                Specifications
                            </button>
                            <button class="tab-btn py-4 px-1 border-b-2 border-transparent text-[#51946c] font-medium" data-tab="reviews">
                                Reviews
                            </button>
                        </nav>
                    </div>

                    <div class="py-8">
                        <!-- Description Tab -->
                        <div id="descriptionTab" class="tab-content">
                            <h3 class="text-xl font-semibold text-[#0e1a13] mb-4">Product Description</h3>
                            <p id="fullDescription" class="text-[#0e1a13] leading-relaxed">
                                Detailed product description will be loaded here...
                            </p>
                        </div>

                        <!-- Specifications Tab -->
                        <div id="specificationsTab" class="tab-content hidden">
                            <h3 class="text-xl font-semibold text-[#0e1a13] mb-4">Product Specifications</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="flex justify-between py-2 border-b border-[#e8f2ec]">
                                    <span class="text-[#51946c]">Product Type:</span>
                                    <span id="specProductType" class="text-[#0e1a13] font-medium">Physical</span>
                                </div>
                                <div class="flex justify-between py-2 border-b border-[#e8f2ec]">
                                    <span class="text-[#51946c]">SKU:</span>
                                    <span id="specSKU" class="text-[#0e1a13] font-medium">BOOK-001</span>
                                </div>
                                <div class="flex justify-between py-2 border-b border-[#e8f2ec]">
                                    <span class="text-[#51946c]">Brand:</span>
                                    <span id="specBrand" class="text-[#0e1a13] font-medium">Brand Name</span>
                                </div>
                                <div class="flex justify-between py-2 border-b border-[#e8f2ec]">
                                    <span class="text-[#51946c]">Category:</span>
                                    <span id="specCategory" class="text-[#0e1a13] font-medium">Books</span>
                                </div>
                                <div class="flex justify-between py-2 border-b border-[#e8f2ec]">
                                    <span class="text-[#51946c]">Tax Rate:</span>
                                    <span id="specTax" class="text-[#0e1a13] font-medium">5%</span>
                                </div>
                                <div class="flex justify-between py-2 border-b border-[#e8f2ec]">
                                    <span class="text-[#51946c]">Business Location:</span>
                                    <span id="specLocation" class="text-[#0e1a13] font-medium">Main Store</span>
                                </div>
                            </div>
                        </div>

                        <!-- Reviews Tab -->
                        <div id="reviewsTab" class="tab-content hidden">
                            <h3 class="text-xl font-semibold text-[#0e1a13] mb-4">Customer Reviews</h3>
                            <div class="space-y-4">
                                <div class="bg-[#e8f2ec] p-4 rounded-lg">
                                    <div class="flex items-center gap-2 mb-2">
                                        <div class="flex text-yellow-400">
                                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                                            </svg>
                                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                                            </svg>
                                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                                            </svg>
                                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                                            </svg>
                                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                                            </svg>
                                        </div>
                                        <span class="text-[#0e1a13] font-medium">John Doe</span>
                                    </div>
                                    <p class="text-[#0e1a13]">Great product! Highly recommended.</p>
                                </div>
                                <div class="bg-[#e8f2ec] p-4 rounded-lg">
                                    <div class="flex items-center gap-2 mb-2">
                                        <div class="flex text-yellow-400">
                                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                                            </svg>
                                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                                            </svg>
                                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                                            </svg>
                                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                                            </svg>
                                        </div>
                                        <span class="text-[#0e1a13] font-medium">Jane Smith</span>
                                    </div>
                                    <p class="text-[#0e1a13]">Excellent quality and fast delivery!</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>

    <script>
        // Load product data from localStorage or use default
        let productData = {
            id: 1,
            name: 'The Secret Garden',
            description: 'A classic children\'s novel about a young girl who discovers a magical garden.',
            fullDescription: 'The Secret Garden is a novel by Frances Hodgson Burnett first published in book form in 1911. The story follows Mary Lennox, a spoiled and sickly 10-year-old girl who is sent to live with her uncle in England after her parents die in a cholera epidemic in India. Mary discovers a hidden garden that has been locked up for years, and with the help of her new friends, she brings it back to life while also healing herself and those around her.',
            image: 'https://images.unsplash.com/photo-1544947950-fa07a98d237f?w=600',
            price: 12.99,
            originalPrice: 15.99,
            discount: 20,
            sku: 'BOOK-001',
            brand: 'Classic Literature',
            category: 'Books',
            productType: 'Physical',
            tax: 5,
            businessLocation: 'Main Store',
            availability: 'In Stock',
            stock: 150
        };

        // Load product data from API or localStorage
        async function loadProductFromStorage() {
            const urlParams = new URLSearchParams(window.location.search);
            const productId = urlParams.get('id');
            if (!productId) return;
            try {
                // Try API first
                const res = await fetch(`/api/products/${productId}`);
                if (res.ok) {
                    const p = await res.json();
                    productData = {
                        id: p._id || p.id,
                        name: p.name,
                        description: p.description || '',
                        fullDescription: p.description || 'No detailed description available.',
                        image: p.image || 'https://via.placeholder.com/600x600?text=No+Image',
                        price: (typeof p.sellingPrice === 'number') ? p.sellingPrice : (p.price || 0),
                        originalPrice: (typeof p.unitPurchasePrice === 'number') ? p.unitPurchasePrice : (p.price || 0),
                        discount: p.discount || 0,
                        sku: p.sku || 'N/A',
                        brand: p.brand || 'N/A',
                        category: p.category || 'N/A',
                        productType: p.productType || 'Physical',
                        tax: p.tax || 0,
                        businessLocation: p.businessLocation || 'N/A',
                        availability: p.availability === 'in_stock' ? 'In Stock' : p.availability === 'low_stock' ? 'Low Stock' : 'Out of Stock',
                        stock: p.currentStock || p.stock || 0
                    };
                    return;
                }
            } catch {}
            // Fallback to localStorage mirror
            const savedProducts = localStorage.getItem('allProducts');
            if (savedProducts) {
                try {
                    const products = JSON.parse(savedProducts);
                    const product = products.find(p => (p._id || p.id) == productId);
                    if (product) {
                        productData = {
                            id: product._id || product.id,
                            name: product.name,
                            description: product.description || '',
                            fullDescription: product.description || 'No detailed description available.',
                            image: product.image || 'https://via.placeholder.com/600x600?text=No+Image',
                            price: product.sellingPrice || product.price || 0,
                            originalPrice: product.unitPurchasePrice || product.price || 0,
                            discount: product.discount || 0,
                            sku: product.sku || 'N/A',
                            brand: product.brand || 'N/A',
                            category: product.category || 'N/A',
                            productType: product.productType || 'Physical',
                            tax: product.tax || 0,
                            businessLocation: product.businessLocation || 'N/A',
                            availability: product.availability === 'in_stock' ? 'In Stock' : product.availability === 'low_stock' ? 'Low Stock' : 'Out of Stock',
                            stock: product.currentStock || product.stock || 0
                        };
                    }
                } catch {}
            }
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            loadProductFromStorage();
            loadProductData();
            setupEventListeners();
            setupTabs();
        });

        // Load product data into the page
        function loadProductData() {
            document.getElementById('productTitle').textContent = productData.name;
            document.getElementById('productNameBreadcrumb').textContent = productData.name;
            document.getElementById('productImage').src = productData.image;
            document.getElementById('productImageThumb1').src = productData.image;
            document.getElementById('productImageThumb2').src = productData.image;
            document.getElementById('productImageThumb3').src = productData.image;
            document.getElementById('productSKU').textContent = `SKU: ${productData.sku}`;
            document.getElementById('productPrice').textContent = `LKR ${productData.price.toFixed(2)}`;
            document.getElementById('productOriginalPrice').textContent = `LKR ${productData.originalPrice.toFixed(2)}`;
            document.getElementById('productDiscount').textContent = `-${productData.discount}%`;
            document.getElementById('productDescription').textContent = productData.description;
            document.getElementById('fullDescription').textContent = productData.fullDescription;
            document.getElementById('productAvailability').textContent = productData.availability;
            document.getElementById('productBrand').textContent = productData.brand;
            document.getElementById('productCategory').textContent = productData.category;
            
            // Specifications
            document.getElementById('specProductType').textContent = productData.productType;
            document.getElementById('specSKU').textContent = productData.sku;
            document.getElementById('specBrand').textContent = productData.brand;
            document.getElementById('specCategory').textContent = productData.category;
            document.getElementById('specTax').textContent = `${productData.tax}%`;
            document.getElementById('specLocation').textContent = productData.businessLocation;
            
            updateTotalPrice();
        }

        // Setup event listeners
        function setupEventListeners() {
            const addToCartBtn = document.getElementById('addToCartBtn');
            const buyNowBtn = document.getElementById('buyNowBtn');

            addToCartBtn.addEventListener('click', addToCart);
            buyNowBtn.addEventListener('click', buyNow);
        }

        // Change quantity function for product detail page
        function changeQuantityDetail(change) {
            const quantitySpan = document.getElementById('quantityDetail');
            if (!quantitySpan) {
                console.log('Quantity span not found');
                return;
            }
            
            let currentQuantity = parseInt(quantitySpan.textContent) || 1;
            console.log('Current quantity:', currentQuantity, 'Change:', change);
            
            // Simple approach - just change the quantity with reasonable limits
            const newQuantity = currentQuantity + change;
            
            // Set reasonable limits (1 to 20 or stock limit)
            const maxStock = Math.min(productData.stock || 20, 20);
            if (newQuantity >= 1 && newQuantity <= maxStock) {
                quantitySpan.textContent = newQuantity;
                // Add visual feedback
                quantitySpan.style.transform = 'scale(1.1)';
                setTimeout(() => {
                    quantitySpan.style.transform = 'scale(1)';
                }, 150);
                console.log('Quantity updated to:', newQuantity);
                updateTotalPrice();
            } else {
                console.log('Quantity out of bounds:', newQuantity);
            }
        }

        // Update total price based on quantity
        function updateTotalPrice() {
            const quantitySpan = document.getElementById('quantityDetail');
            const quantity = quantitySpan ? parseInt(quantitySpan.textContent) : 1;
            const total = productData.price * quantity;
            document.getElementById('totalPrice').textContent = `LKR ${total.toFixed(2)}`;
        }

        // Setup tab functionality
        function setupTabs() {
            const tabBtns = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');

            tabBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const targetTab = btn.getAttribute('data-tab');
                    
                    // Update active tab button
                    tabBtns.forEach(b => {
                        b.classList.remove('active', 'border-[#19e619]', 'text-[#19e619]');
                        b.classList.add('border-transparent', 'text-[#51946c]');
                    });
                    btn.classList.add('active', 'border-[#19e619]', 'text-[#19e619]');
                    btn.classList.remove('border-transparent', 'text-[#51946c]');
                    
                    // Show target tab content
                    tabContents.forEach(content => {
                        content.classList.add('hidden');
                    });
                    document.getElementById(`${targetTab}Tab`).classList.remove('hidden');
                });
            });
        }

        // Add to cart functionality
        function addToCart() {
            const quantitySpan = document.getElementById('quantityDetail');
            const quantity = quantitySpan ? parseInt(quantitySpan.textContent) : 1;
            const cartItem = {
                id: productData.id,
                name: productData.name,
                price: productData.price,
                image: productData.image,
                quantity: quantity
            };
            
            // Get existing cart from localStorage
            let cart = JSON.parse(localStorage.getItem('cart')) || [];
            
            // Check if item already exists in cart
            const existingItemIndex = cart.findIndex(item => item.id === cartItem.id);
            if (existingItemIndex !== -1) {
                cart[existingItemIndex].quantity += quantity;
            } else {
                cart.push(cartItem);
            }
            
            // Save to localStorage
            localStorage.setItem('cart', JSON.stringify(cart));
            
            // Show success message
            alert('Product added to cart successfully!');
        }

        // Buy now functionality
        function buyNow() {
            const quantitySpan = document.getElementById('quantityDetail');
            const quantity = quantitySpan ? parseInt(quantitySpan.textContent) : 1;
            // Redirect to checkout page with product data
            const checkoutData = {
                items: [{
                    id: productData.id,
                    name: productData.name,
                    price: productData.price,
                    image: productData.image,
                    quantity: quantity
                }],
                total: productData.price * quantity
            };
            
            localStorage.setItem('checkout', JSON.stringify(checkoutData));
            window.location.href = 'checkout.html';
        }
    </script>
</body>
</html>
